# name: test/sql/a5.test
# description: test a5 extension
# group: [sql]

# Before we load the extension, this will fail
statement error
SELECT a5('test');
----
Catalog Error: Scalar Function with name a5 does not exist!

# Require statement will ensure this test is run with this extension loaded
require a5

query R
select a5_cell_area(4)
----
132829589786.31229

query R
select a5_cell_area(columns(*)::integer) from range(31)
----
42505468731619.93
8501093746323.985
2125273436580.9963
531318359145.2491
132829589786.31229
33207397446.578068
8301849361.644517
2075462340.4111292
518865585.1027823
129716396.27569558
32429099.068923894
8107274.767230974
2026818.6918077432
506704.67295193585
126676.16823798396
31669.04205949599
7917.260514873998
1979.3151287184992
494.82878217962485
123.7071955449062
30.926798886226553
7.731699721556638
1.9329249303891596
0.4832312325972899
0.12080780814932247
0.03020195203733062
0.007550488009332655
0.0018876220023331637
0.0004719055005832909
0.00011797637514582271
2.949409378645568e-05

query I
select a5_num_cells(columns(*)::integer) from range(31)
----
12
60
240
960
3840
15360
61440
245760
983040
3932160
15728640
62914560
251658240
1006632960
4026531840
16106127360
64424509440
257698037760
1030792151040
4123168604160
16492674416640
65970697666560
263882790666240
1055531162664960
4222124650659840
16888498602639360
67553994410557440
270215977642229760
1080863910568919000
4323455642275676000
17293822569102705000

# FIXME: should test resolutinos up to 30, not just 29
query I
select a5_resolution(a5_lon_lat_to_cell(55, 44, columns(*)::integer)) from range(30);
----
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29


query I
select a5_lon_lat_to_cell(55, 44, columns(*)::integer) from range(30);
----
1585267068834414592
7277816997830721536
7385903388887613440
7376896189632872448
7374644389819187200
7376333239679451136
7375629552237674496
7375735105353940992
7375726309260918784
7375724110237663232
7375724659993477120
7375724797432430592
7375724763072692224
7375724909101580288
7375724902659129344
7375724901048516608
7375724903598653440
7375724903565099008
7375724903472824320
7375724903470727168
7375724903506903040
7375724903470858240
7375724903507329024
7375724903507304448
7375724903507314688
7375724903507324416
7375724903507325312
7375724903507325344
7375724903507325336
7375724903507325338


query I
select a5_cell_to_parent(a5_lon_lat_to_cell(55, 44, columns(*)::integer), columns(*)::integer-1) from range(1, 30);
----
1585267068834414592
7277816997830721536
7385903388887613440
7376896189632872448
7374644389819187200
7375207339772608512
7375629552237674496
7375735105353940992
7375726309260918784
7375724110237663232
7375724659993477120
7375724797432430592
7375724900511645696
7375724909101580288
7375724902659129344
7375724903196000256
7375724903598653440
7375724903497990144
7375724903472824320
7375724903508475904
7375724903471251456
7375724903507296256
7375724903507329024
7375724903507320832
7375724903507322880
7375724903507325440
7375724903507325312
7375724903507325344
7375724903507325336

query I
select list_transform(a5_cell_to_lon_lat(a5_lon_lat_to_cell(55, 44, columns(*)::integer)), x -> round(x)) from range(1, 30);
----
[51.0, 48.0]
[57.0, 48.0]
[56.0, 45.0]
[53.0, 44.0]
[56.0, 45.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]