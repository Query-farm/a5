# name: test/sql/a5.test
# description: test a5 extension
# group: [sql]

# Before we load the extension, this will fail
statement error
SELECT a5('test');
----
Catalog Error: Scalar Function with name a5 does not exist!

# Require statement will ensure this test is run with this extension loaded
require a5

query R
select round(a5_area(columns(*)::integer)) from range(31)
----
42505468731620.0
8501093746324.0
2125273436581.0
531318359145.0
132829589786.0
33207397447.0
8301849362.0
2075462340.0
518865585.0
129716396.0
32429099.0
8107275.0
2026819.0
506705.0
126676.0
31669.0
7917.0
1979.0
495.0
124.0
31.0
8.0
2.0
0.0
0.0
0.0
0.0
0.0
0.0
0.0
0.0

query I
select a5_num_cells(columns(*)::integer) from range(31)
----
12
60
240
960
3840
15360
61440
245760
983040
3932160
15728640
62914560
251658240
1006632960
4026531840
16106127360
64424509440
257698037760
1030792151040
4123168604160
16492674416640
65970697666560
263882790666240
1055531162664960
4222124650659840
16888498602639360
67553994410557440
270215977642229760
1080863910568919000
4323455642275676000
17293822569102705000

# FIXME: should test resolutinos up to 30, not just 29
query I
select a5_resolution(a5_cell(55, 44, columns(*)::integer)) from range(30);
----
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29


query I
select a5_cell(55, 44, columns(*)::integer) from range(30);
----
1585267068834414592
7277816997830721536
7385903388887613440
7376896189632872448
7374644389819187200
7376333239679451136
7375629552237674496
7375735105353940992
7375726309260918784
7375724110237663232
7375724659993477120
7375724797432430592
7375724763072692224
7375724909101580288
7375724902659129344
7375724901048516608
7375724903598653440
7375724903565099008
7375724903472824320
7375724903470727168
7375724903506903040
7375724903470858240
7375724903507329024
7375724903507304448
7375724903507314688
7375724903507324416
7375724903507325312
7375724903507325344
7375724903507325336
7375724903507325338


query I
select a5_parent(a5_cell(55, 44, columns(*)::integer), columns(*)::integer-1) from range(1, 30);
----
1585267068834414592
7277816997830721536
7385903388887613440
7376896189632872448
7374644389819187200
7375207339772608512
7375629552237674496
7375735105353940992
7375726309260918784
7375724110237663232
7375724659993477120
7375724797432430592
7375724900511645696
7375724909101580288
7375724902659129344
7375724903196000256
7375724903598653440
7375724903497990144
7375724903472824320
7375724903508475904
7375724903471251456
7375724903507296256
7375724903507329024
7375724903507320832
7375724903507322880
7375724903507325440
7375724903507325312
7375724903507325344
7375724903507325336

query I
select list_transform(a5_lon_lat(a5_cell(55, 44, columns(*)::integer)), x -> round(x)) from range(1, 30);
----
[51.0, 48.0]
[57.0, 48.0]
[56.0, 45.0]
[53.0, 44.0]
[56.0, 45.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]
[55.0, 44.0]

query I
select a5_res0_cells()
----
[144115188075855872, 432345564227567616, 720575940379279360, 1008806316530991104, 1297036692682702848, 1585267068834414592, 1873497444986126336, 2161727821137838080, 2449958197289549824, 2738188573441261568, 3026418949592973312, 3314649325744685056]


query I
select a5_children(a5_cell(55, 44, columns(*)::integer), columns(*)::integer+1)  from range(0, 29);
----
[7566047373982433280, 7854277750134145024, 8142508126285856768, 8430738502437568512, 7277816997830721536]
[7241788200811757568, 7313845794849685504, 7385903388887613440, 7457960982925541376]
[7358881791123390464, 7376896189632872448, 7394910588142354432, 7412924986651836416]
[7370140790191816704, 7374644389819187200, 7379147989446557696, 7383651589073928192]
[7372955539958923264, 7374081439865765888, 7375207339772608512, 7376333239679451136]
[7375911027214385152, 7376192502191095808, 7376473977167806464, 7376755452144517120]
[7375523999121408000, 7375594367865585664, 7375664736609763328, 7375735105353940992]
[7375708717074874368, 7375726309260918784, 7375743901446963200, 7375761493633007616]
[7375719712191152128, 7375724110237663232, 7375728508284174336, 7375732906330685440]
[7375722460970221568, 7375723560481849344, 7375724659993477120, 7375725759505104896]
[7375724247676616704, 7375724522554523648, 7375724797432430592, 7375725072310337536]
[7375724694353215488, 7375724763072692224, 7375724831792168960, 7375724900511645696]
[7375724737302888448, 7375724754482757632, 7375724771662626816, 7375724788842496000]
[7375724902659129344, 7375724906954096640, 7375724911249063936, 7375724915544031232]
[7375724901048516608, 7375724902122258432, 7375724903196000256, 7375724904269742080]
[7375724900645863424, 7375724900914298880, 7375724901182734336, 7375724901451169792]
[7375724903497990144, 7375724903565099008, 7375724903632207872, 7375724903699316736]
[7375724903539933184, 7375724903556710400, 7375724903573487616, 7375724903590264832]
[7375724903466532864, 7375724903470727168, 7375724903474921472, 7375724903479115776]
[7375724903469154304, 7375724903470202880, 7375724903471251456, 7375724903472300032]
[7375724903506509824, 7375724903506771968, 7375724903507034112, 7375724903507296256]
[7375724903470759936, 7375724903470825472, 7375724903470891008, 7375724903470956544]
[7375724903507304448, 7375724903507320832, 7375724903507337216, 7375724903507353600]
[7375724903507298304, 7375724903507302400, 7375724903507306496, 7375724903507310592]
[7375724903507313152, 7375724903507314176, 7375724903507315200, 7375724903507316224]
[7375724903507324032, 7375724903507324288, 7375724903507324544, 7375724903507324800]
[7375724903507325216, 7375724903507325280, 7375724903507325344, 7375724903507325408]
[7375724903507325320, 7375724903507325336, 7375724903507325352, 7375724903507325368]
[7375724903507325330, 7375724903507325334, 7375724903507325338, 7375724903507325342]